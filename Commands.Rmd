---
title: "Capstone Intro to NFL data"
author: "JMeerse"
date: "`r Sys.Date()`"
output: html_document
---
```{r}
```
# Getting started with NFL data and R  
Start by loading the nflfastR package and library, and tidyverse. You only have to do this once.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
install.packages("nflfastR",repos = "http://cran.us.r-project.org")
install.packages("tidyverse",repos = "http://cran.us.r-project.org")
```
## Load libraries  
R makes "packages" of commands that are useful for different kinds of data analysis.  In order to use those commands, you load the libraries of commands *each time* you run your project.

```{r libraries}
library(nflfastR)
library(tidyverse)
```

## Load data  
NflfastR allows us to download all the plays from various seasons. Let's get all the plays from the 2021-22 season, into a dataframe called pbp22

```{r data}
pbp21 <- load_pbp(2021) 
```
### What did we just do?  
We used the command `load_pbp()` to specify we wanted the play-by-play data from the 2021-22 season./
We also assigned that play-by-play data to a dataframe (similar to a spreadsheet) called pbp21./
In the upper right of your RStudio window you should see this object.  How many plays were run during the season?

Now let's look at the data. 
```{r looking at our data}
head(pbp21)

#names(pbp21)

```
The first command, `head()`, showed the first 6 rows of the data, and only 6 of the 372 variables recorded for each play.\
The second command, `names()`, will show the names of all 372 variables.\  
How do we know what each variable represents?

Go to the link: 
https://nflreadr.nflverse.com/articles/dictionary_pbp.html


## Initial Questions - using `filter()` to just look at runs \
The command below takes the pbp21 dataframe and applies 2 filters, and creates a new dataframe.\

1) What is the new dataframe called, and how many observations does it have? \
2) What type of plays are in the dataframe? \
3) What games are represented in the dataframe? 
```{r initial questions}
run21 <- pbp21 %>% filter(season_type == "REG" & play_type == "run") 
```
Let's look at yards gained through statistics and graphs.

```{r}
summary(run21$yards_gained) #summary stats
run21 %>% ggplot(aes(x = yards_gained)) + 
  geom_boxplot() + 
  facet_wrap(~ posteam)

run21 %>% ggplot(aes(x = yards_gained)) + 
  geom_histogram() 
```

Can we compare home and away? \
Two new commands - `group_by()` and `summarise()`\

Here, we want to find the average yards gained on running plays for each team. Further, we break it down to when they're playing at home and when they're playing away.
```{r}

ha_run_diff <- run21 %>% 
  group_by(posteam, posteam_type) %>% 
  summarise(ave_yards = mean(yards_gained),
            n = n()) %>% 
  ungroup()

```


